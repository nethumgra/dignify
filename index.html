<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dignify Ceylon - Authentic BM Foods</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Galada&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
        }

        #page-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('https://i.ibb.co/Gfg6DS3V/a-HR0c-HM6-Ly9l-Ln-N0-YWVkd-Gxlcm-Nkbi5j.png');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center center;
            opacity: 0.05;
            z-index: -1;
        }

        #content-wrapper {
            position: relative;
            z-index: 1;
        }
        
        .font-brand {
            font-family: 'Galada', cursive;
        }

        .sidebar-panel { transition: transform 0.3s ease-in-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 5px;}
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
        .tab-panel { display: none; }
        .tab-panel.active { display: grid; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .swiper-pagination-bullet-active {
            background-color: #16a34a;
        }
        
        .goals-swiper .swiper-pagination-bullet {
            background-color: rgba(255, 255, 255, 0.6);
            opacity: 1;
        }
        .goals-swiper .swiper-pagination-bullet-active {
            background-color: #ffffff;
        }
        .goals-swiper .swiper-pagination {
            bottom: 16px !important;
        }
    </style>
</head>
<body class="text-gray-800">

<div id="page-background"></div>

<div id="content-wrapper">

    <div class="bg-green-900 text-white text-center py-2 text-sm">
        Free Island-wide Delivery on Orders Over Rs. 5000!
    </div>

    <nav class="bg-white text-gray-800 px-4 py-4 sticky top-0 z-40 shadow-sm border-b">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <a href="index.html" class="font-brand text-3xl tracking-wider text-green-800">Dignify Ceylon</a>
            </div>
    
            <div class="hidden lg:flex flex-grow max-w-xl mx-8">
                <form id="desktop-search-form" class="w-full flex items-center border border-gray-300 rounded-md">
                    <div class="relative">
                        <select class="pl-4 pr-8 py-2 bg-gray-100 rounded-l-md border-r border-gray-300 text-sm focus:outline-none appearance-none">
                            <option>All</option>
                            <option>Spices & Herbs</option>
                            <option>Snacks & Sweets</option>
                            <option>Ready to Eat</option>
                            <option>Beverages</option>
                        </select>
                    </div>
                    <input type="text" id="desktop-search-input" placeholder="Search for spices, snacks..." class="w-full py-2 px-4 text-gray-900 placeholder-gray-500 focus:outline-none">
                    <button type="submit" class="px-6 py-2 bg-green-700 text-white font-semibold rounded-r-md hover:bg-green-800">
                        Search
                    </button>
                </form>
            </div>
    
            <div class="flex items-center space-x-6">
                <a href="cart.html" id="cart-button" class="flex items-center gap-2 hover:text-green-600 relative">
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.658-.463 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-amber-400 text-black text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center border-2 border-white">0</span>
                </a>
                 <button id="user-button" class="flex items-center gap-2 hover:text-green-600">
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                    <span id="user-text" class="text-sm hidden md:block">Log in / Register</span>
                </button>
            </div>
        </div>
    
        <div class="mt-3 lg:hidden">
            <form id="mobile-search-form" class="w-full">
                <div class="relative">
                    <input type="text" id="mobile-search-input" placeholder="Search for spices, snacks..." class="w-full py-2 pl-4 pr-12 rounded-md text-gray-900 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button type="submit" class="absolute inset-y-0 right-0 flex items-center px-4 bg-green-700 rounded-r-md">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                </div>
            </form>
        </div>
    </nav>
    
   <header>
    <div class="relative">
        <div class="swiper heroSwiper w-full aspect-[4/3] sm:aspect-[16/9] md:aspect-[16/8] lg:aspect-[16/6]">
            <div class="swiper-wrapper">

                <div class="swiper-slide">
                    <picture>
                        <source media="(min-width: 1024px)" srcset="https://i.ibb.co/Psh7srJv/LINEN-SHIRTS-28.png">
                        <source media="(min-width: 768px)" srcset="https://i.ibb.co/G4KC1F7Q/LINEN-SHIRTS-30.png">
                        <img src="https://i.ibb.co/tw4YTtC5/LINEN-SHIRTS-32.pngvv" class="w-full h-full object-cover" alt="Super Fins Hero Image 1" />
                    </picture>
                </div>

                <div class="swiper-slide">
                    <picture>
                        <source media="(min-width: 1024px)" srcset="https://i.ibb.co/7J0NrSx6/LINEN-SHIRTS-29.png">
                        <source media="(min-width: 768px)" srcset="https://i.ibb.co/hxLVVywD/LINEN-SHIRTS-19.png">
                        <img src="https://i.ibb.co/LdH3495K/LINEN-SHIRTS-20.png" class="w-full h-full object-cover" alt="Watersports Action" />
                    </picture>
                </div>

            
            </div>
            <div class="swiper-pagination"></div>
        </div>
    </div>
</header>

    <section class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="flex items-center gap-4">
                    <img src="https://img.icons8.com/ios/50/22c55e/restaurant.png" alt="Authentic Flavours" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Authentic Flavours</h3>
                        <p class="text-sm text-gray-600">Taste the tradition.</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                     <img src="https://img.icons8.com/ios/50/22c55e/sprout.png" alt="Freshly Packed" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Freshly Packed</h3>
                        <p class="text-sm text-gray-600">Sealed for freshness.</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <img src="https://img.icons8.com/ios/50/22c55e/box.png" alt="Secure Packaging" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Secure Packaging</h3>
                        <p class="text-sm text-gray-600">Delivered safe and sound.</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <img src="https://img.icons8.com/ios/50/22c55e/cash-on-delivery.png" alt="Cash on Delivery" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Cash on Delivery</h3>
                        <p class="text-sm text-gray-600">Pay at your doorstep.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="pb-9">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div id="category-scroller" class="flex space-x-4 overflow-x-auto snap-x snap-mandatory no-scrollbar p-2">
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/kVGmH1JR/2.jpg" alt="Spices & Herbs" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/35NXqLTj/1.jpg" alt="Snacks & Sweets" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/tTnJQM1q/3.jpg" alt="Ready to Eat" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/twZsNQmb/4.jpg" alt="Beverages" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/0RLsGDty/5.jpg" alt="Organic Products" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/xKyhBNm2/BEET-ROOT-PASTA.png" alt="Gift Packs" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
        </div>
    </div>
</section>
    
    <div id="product-grid-container" class="max-w-7xl mx-auto px-4 pt-3 pb-16">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-x-8">
            <aside id="desktop-filter-panel" class="hidden lg:block lg:col-span-1">
                <div class="space-y-8 sticky top-28">
                    <div class="border rounded-lg p-4 bg-blue-50 border-blue-200">
                        <h3 class="font-semibold mb-4 text-lg text-gray-800">Wholesale Rules & Regulations</h3>
                        <div class="space-y-3 text-sm text-gray-700">
                            <p>To partner with us for wholesale purchases, please adhere to the following guidelines:</p>
                            <ul class="list-disc list-inside space-y-2 pl-1">
                                <li><strong>Minimum Order (MOQ):</strong> A minimum of 20 units per order is required.</li>
                                <li><strong>Pricing:</strong> Special wholesale pricing is available. Please contact us via WhatsApp for a detailed quote.</li>
                                <li><strong>Ordering:</strong> All wholesale orders must be placed directly through our WhatsApp business line for efficient processing.</li>
                                <li><strong>Payment:</strong> A 50% advance payment is required to confirm your order, with the remaining balance due before dispatch.</li>
                                <li><strong>Delivery:</strong> We offer island-wide delivery. Delivery charges may apply based on order size and location.</li>
                            </ul>
                            <p class="pt-2 font-semibold text-blue-800">Contact us today to get started!</p>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <h3 class="font-semibold mb-4 text-gray-800">Category</h3>
                            <div id="desktop-category-filter-list" class="space-y-2">
                                </div>
                        </div>
                        </div>
                </div>
            </aside>
            <main class="lg:col-span-3">
                <div id="main-content-area">
                    <p class="col-span-full text-center text-gray-500 text-lg">Loading...</p>
                </div>
            </main>
        </div>
    </div>
    
   <div id="mobile-filter-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden lg:hidden">
    <div id="mobile-filter-panel" class="sidebar-panel absolute top-0 left-0 h-full w-full max-w-sm bg-white shadow-xl transform -translate-x-full flex flex-col">
        <div class="flex items-center justify-between p-4 border-b">
            <h2 class="text-lg font-semibold">Filter & Sort</h2>
            <button id="close-filter-btn" class="p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
        </div>

        <div class="p-4 overflow-y-auto flex-grow custom-scrollbar">
            <div class="bg-blue-50 border border-blue-200 p-3 rounded-md mb-6">
               <h3 class="font-semibold mb-3 text-base text-gray-800">Wholesale Rules & Regulations</h3>
               <div class="space-y-3 text-sm text-gray-700">
                    <p>To partner with us for wholesale purchases, please adhere to the following guidelines:</p>
                    <ul class="list-disc list-inside space-y-2 pl-1">
                        <li><strong>Minimum Order (MOQ):</strong> A minimum of 20 units per order is required.</li>
                        <li><strong>Pricing:</strong> Special wholesale pricing is available. Please contact us via WhatsApp for a detailed quote.</li>
                        <li><strong>Ordering:</strong> All wholesale orders must be placed directly through our WhatsApp business line for efficient processing.</li>
                        <li><strong>Payment:</strong> A 50% advance payment is required to confirm your order, with the remaining balance due before dispatch.</li>
                        <li><strong>Delivery:</strong> We offer island-wide delivery. Delivery charges may apply based on order size and location.</li>
                    </ul>
                    <p class="pt-2 font-semibold text-blue-800">Contact us today to get started!</p>
               </div>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="font-semibold mb-4 text-gray-800">Category</h3>
                    <div id="mobile-category-filter-list" class="space-y-2">
                        </div>
                </div>
                <div>
                    <h3 class="font-semibold mb-4 text-gray-800">Sort By</h3>
                    <select id="mobile-sort-select" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                        <option value="createdAt-desc">Newest</option>
                        <option value="price-asc">Price: Low to High</option>
                        <option value="price-desc">Price: High to Low</option>
                    </select>
                </div>
            </div>
        </div>
        
    </div>
</div>

    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
         <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
             <div class="flex border-b">
                 <button id="login-tab" class="flex-1 py-3 font-semibold text-center bg-gray-100 text-gray-800 rounded-tl-lg">Login</button>
                 <button id="signup-tab" class="flex-1 py-3 font-semibold text-center bg-white text-gray-500">Sign Up</button>
             </div>
             <div class="p-8">
                 <form id="login-form" class="space-y-4">
                      <div>
                          <label for="login-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                          <input type="email" id="login-email" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                      </div>
                      <div>
                          <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                          <input type="password" id="login-password" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                      </div>
                      <button type="submit" class="w-full bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">Login</button>
                 </form>
                 <form id="signup-form" class="space-y-4 hidden">
                      <div>
                          <label for="signup-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                          <input type="email" id="signup-email" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                      </div>
                      <div>
                          <label for="signup-password" class="block text-sm font-medium text-gray-700">Password</label>
                          <input type="password" id="signup-password" minlength="6" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                          <p class="text-xs text-gray-500 mt-1">Must be at least 6 characters long.</p>
                      </div>
                      <button type="submit" class="w-full bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">Create Account</button>
                 </form>
                 <div class="relative flex py-5 items-center">
                      <div class="flex-grow border-t border-gray-200"></div>
                      <span class="flex-shrink mx-4 text-xs text-gray-400 uppercase">Or</span>
                      <div class="flex-grow border-t border-gray-200"></div>
                 </div>
                 <button id="google-signin-btn" class="w-full flex items-center justify-center py-2.5 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">
                      <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"></path><path fill="#FF3D00" d="m6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"></path><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.223 0-9.641-3.657-11.297-8.591l-6.522 5.025C9.505 39.556 16.227 44 24 44z"></path><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.574l6.19 5.238C42.012 35.245 44 30.024 44 24c0-1.341-.138-2.65-.389-3.917z"></path></svg>
                      Sign in with Google
                 </button>
                 <p id="auth-error" class="text-red-500 text-sm mt-4 text-center"></p>
             </div>
        </div>
    </div>
    
    <div id="user-info-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
            <h2 class="text-lg font-medium text-gray-900">Welcome!</h2>
            <p id="user-email-display" class="mt-2 text-sm text-gray-600 truncate"></p>
            <a href="my-orders.html" id="my-orders-button" class="mt-4 w-full block bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">My Orders</a>
            <button id="logout-button" class="mt-2 w-full bg-red-600 text-white font-bold py-2.5 rounded-md hover:bg-red-700 transition">Logout</button>
            <button id="close-user-modal" class="mt-2 w-full text-gray-600 text-sm py-2">Close</button>
        </div>
    </div>

     <section class="py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
            <div>
                <img src="https://i.ibb.co/k2cvwnfQ/DIGNIFY-CEYLON.jpg" alt="Hands holding authentic Sri Lankan spices" class="rounded-lg shadow-2xl w-full h-full object-cover">
            </div>
            <div class="space-y-4">
                <h2 class="text-3xl font-bold text-gray-800 tracking-tight">Our Story: The Essence of Ceylon</h2>
                <p class="text-gray-600 leading-relaxed">
                    Born from a passion for authentic Sri Lankan flavors, Dignify Ceylon is more than just a brand; it's a promise of quality and tradition. We began our journey to bring the true taste of our island's rich culinary heritage to every home, ensuring that every meal is a celebration.
                </p>
                <p class="text-gray-600 leading-relaxed">
                    We work directly with local farmers to source the freshest, highest-quality ingredients. Each product is prepared with care, following age-old recipes to preserve the natural goodness and authentic taste that you love. From our spices to our ready-to-eat meals, we bring you the heart of Ceylon's cuisine.
                </p>
            </div>
        </div>
    </section>

    
   <section id="achievements-section" class="bg-white py-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col-reverse md:flex-row gap-12 items-center">
            
            <div class="space-y-5 w-full md:w-1/2">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Our Achievements</h2>
                <span class="text-green-700 font-bold uppercase tracking-wider">A MARK OF EXCELLENCE</span>
                <h3 class="text-2xl font-bold text-gray-800">Delivering Certified Quality & Authentic Taste</h3>
                <p id="dynamic-achievement-description" class="text-gray-600 leading-relaxed min-h-[100px] transition-opacity duration-300">
                </p>
                <div class="pt-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Our Credentials:</h4>
                    <ul class="space-y-4">
                        <li class="flex items-start text-gray-600">
                            <svg class="w-5 h-5 text-green-500 mr-3 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <span><strong>Certified for Quality:</strong> Our production facilities are ISO 22000 and HACCP certified, ensuring the highest standards of food safety and quality management.</span>
                        </li>
                        <li class="flex items-start text-gray-600">
                           <svg class="w-5 h-5 text-green-500 mr-3 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            <span><strong>Award-Winning Taste:</strong> Recognized with the 'National Food Exporter of the Year 2024' award for our commitment to authentic flavour.</span>
                        </li>
                        <li class="flex items-start text-gray-600">
                            <svg class="w-5 h-5 text-green-500 mr-3 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <span><strong>Trusted by Thousands:</strong> Proudly serving over 50,000 satisfied customers in Sri Lanka and across the globe who trust us for purity and taste.</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="relative rounded-lg shadow-xl overflow-hidden w-full md:w-1/2">
                <div class="swiper goals-swiper h-full">
                    <div class="swiper-wrapper">
                        
                        <div class="swiper-slide youtube-slide" data-description="Watch our official company video to see our dedication to quality and the authentic process behind our products, from the heart of Sri Lanka to your table.">
                            <div class="aspect-video">
                                <iframe id="youtube-player" class="w-full h-full" 
                                    src="https://www.youtube.com/embed/kX5yDwbTwik?enablejsapi=1&autoplay=0&mute=1&loop=1&playlist=kX5yDwbTwik&controls=0&modestbranding=1" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>

                        <div class="swiper-slide" data-description="This is the official registration certificate for the business named 'Dignify Ceylon Food Products', issued by the Department of Business Names Registration of the Western Province, confirming our legal operation in Sri Lanka.">
                            <img src="https://i.ibb.co/SDCgJrsy/Untitled-design-3.png" alt="Official Business Registration Certificate" class="w-full h-auto object-contain">
                        </div>
                        
                        <div class="swiper-slide" data-description="This certificate confirms the successful completion of a course in Thailand Food Dehydration Technology by our leadership, covering advanced dehydration methods, packaging, and zero-waste management.">
                            <img src="https://i.ibb.co/vK0WwQX/Untitled-design-2.png" alt="Certificate for Thailand Food Dehydration Technology" class="w-full h-auto object-contain">
                        </div>

                        <div class="swiper-slide" data-description="A professional endorsement from High Tags Holding (Pvt) Ltd, vouching for the high standard of our 100% natural, preservative-free coconut products and excellent service for international logistics.">
                            <img src="https://i.ibb.co/b52GDR0r/Untitled-design-1.png" alt="Recommendation Letter from High Tags Holding" class="w-full h-auto object-contain">
                        </div>

                    </div>
                    <div class="swiper-button-next text-white after:text-2xl"></div>
                    <div class="swiper-button-prev text-white after:text-2xl"></div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>

        </div>
    </div>
</section>

<section id="contact-us" class="bg-white py-2">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Get In Touch</h2>
            <p class="mt-4 text-lg text-gray-600">Have questions? We'd love to hear from you.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
            <div class="space-y-6">
                <div>
                    <h3 class="text-xl font-semibold text-gray-800">Contact Information</h3>
                    <p class="text-gray-600 mt-2">Fill up the form and our team will get back to you within 24 hours.</p>
                </div>
                <div class="flex items-center space-x-4 text-gray-700">
                    <svg class="w-6 h-6 text-green-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 6.75z" />
                    </svg>
                    <span>+94 77 900 4063</span>
                </div>
                <div class="flex items-center space-x-4 text-gray-700">
                    <svg class="w-6 h-6 text-green-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                    </svg>
                    <span>contact@dignifyceylon.com</span>
                </div>
                <div class="flex items-start space-x-4 text-gray-700">
                    <svg class="w-6 h-6 text-green-700 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                    </svg>
                    <span>Main Street, Colombo, Sri Lanka</span>
                </div>
            </div>

            <div class="bg-gray-50 p-8 rounded-lg shadow-md">
                <form id="contact-form" novalidate>
                    <div class="space-y-6">
                        <div>
                            <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                            <input type="text" id="contact-name" name="name" required class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label for="contact-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="contact-email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label for="contact-message" class="block text-sm font-medium text-gray-700 mb-1">Message</label>
                            <textarea id="contact-message" name="message" rows="5" required class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></textarea>
                        </div>
                        <div>
                            <button type="submit" class="w-full bg-green-700 text-white font-bold py-3 px-6 rounded-md hover:bg-green-800 transition-colors flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M1.94631 9.42398C1.83325 8.94193 2.23558 8.48421 2.71074 8.52936L21.4988 10.0526C21.933 10.0941 22.1465 10.6183 21.8485 10.9419L19.0195 14.004C18.8211 14.2183 18.5143 14.2479 18.2868 14.0729L13.1678 10.3755C13.0617 10.2941 12.9056 10.3635 12.8943 10.4907L12.0125 19.8631C11.9961 20.0416 11.8021 20.1424 11.6375 20.0461L8.14693 17.9317C7.94273 17.8142 7.78137 17.6118 7.72295 17.3809L5.80858 9.8732C5.74837 9.63583 5.86476 9.39294 6.08865 9.27419L11.5312 6.18235C11.6601 6.10729 11.8153 6.20853 11.7877 6.36106L10.3123 15.1118L13.7844 17.6536L16.2737 15.0116L12.4208 11.5173C12.1154 11.2366 12.158 10.7485 12.4938 10.5126L17.337 7.21808L3.89666 8.46825L6.20171 16.082L7.30933 16.595L8.94827 10.0231C9.02058 9.73693 8.8475 9.44497 8.56069 9.38012L2.09115 8.08328C2.01358 8.06797 1.93895 8.03157 1.87974 7.97962C1.7259 7.84478 1.63855 7.63281 1.6845 7.4299L2.50284 3.78417C2.59019 3.39572 2.1462 3.09033 1.77681 3.28454L0.424299 3.96081C0.0549045 4.15501 -0.118081 4.64307 0.052824 5.01898L1.94631 9.42398Z"/></svg>
                                <span>Send Message on WhatsApp</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

    
    <footer class="bg-green-900 text-white">
        <div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-brand text-2xl mb-4">Dignify Ceylon</h3>
                    <p class="text-gray-400 text-sm">
                        Discover authentic Sri Lankan flavours with Dignify Ceylon. Quality ingredients, freshly packed for your home.
                    </p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Shop</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-white">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Spices</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Snacks</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Beverages</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Help</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Shipping & Returns</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Stay Connected</h3>
                    <p class="text-gray-400 text-sm mb-3">Get exclusive deals and updates straight to your inbox.</p>
                    <form class="flex">
                        <input type="email" placeholder="Your Email" class="w-full rounded-l-md py-2 px-3 text-gray-800 focus:outline-none">
                        <button type="submit" class="bg-green-700 hover:bg-green-800 rounded-r-md px-4 py-2 font-semibold">Go</button>
                    </form>
                    <div class="flex space-x-4 mt-6">
                        <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0h-21.35C.59 0 0 .59 0 1.325v21.351C0 23.41.59 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116c.735 0 1.325-.59 1.325-1.325V1.325C24 .59 23.41 0 22.675 0z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616v.064c0 2.294 1.634 4.208 3.803 4.649-.623.169-1.272.23-1.933.23-.3 0-.594-.029-.884-.084.618 1.884 2.408 3.258 4.533 3.3-1.625 1.27-3.673 2.022-5.904 2.022-.383 0-.76-.022-1.13-.066 2.099 1.353 4.606 2.148 7.321 2.148 8.778 0 13.59-7.278 13.59-13.59 0-.205-.005-.409-.013-.612.932-.672 1.738-1.512 2.379-2.465z"></path></svg></a>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-green-800 text-center text-sm text-gray-400">
                <p>&copy; 2025 Dignify Ceylon. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, where, onSnapshot, doc, setDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- Firebase Config ---
      const firebaseConfig = {
            apiKey: "AIzaSyCpLC8en-GBODf7Xk-uSpZg_HB37J5a-4I",
            authDomain: "dignify-69351.firebaseapp.com",
            projectId: "dignify-69351",
            storageBucket: "dignify-69351.appspot.com",
            messagingSenderId: "141142153545",
            appId: "1:141142153545:web:c464f04b452206d1456298",
            measurementId: "G-FV52NPV5Q4"
        };
        
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    // --- DOM Elements ---
    const mainContentArea = document.getElementById('main-content-area');
    const userButton = document.getElementById('user-button');
    const mobileFilterSidebar = document.getElementById('mobile-filter-sidebar');
    const mobileFilterPanel = document.getElementById('mobile-filter-panel');
    const closeFilterBtn = document.getElementById('close-filter-btn');
    const authModal = document.getElementById('auth-modal');
    const userInfoModal = document.getElementById('user-info-modal');
    const userText = document.getElementById('user-text');
    const currencyModal = document.getElementById('currency-modal');
    
    // --- Global State ---
    let currentFilters = {};
    let currentSort = { field: 'createdAt', direction: 'desc' };
    let wishlistedProductIds = new Set();
    let cartListener = null;
    let wishlistListener = null;
    
    // --- New Currency State ---
    let selectedCurrency = 'LKR'; 
    const LKR_TO_USD_RATE = 300; // IMPORTANT: Set your exchange rate here. 1 USD = 300 LKR

    // --- Icons ---
    const heartIconEmpty = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg>`;
    const heartIconFilled = `<svg class="w-6 h-6" fill="currentColor" class="text-red-500" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>`;
    const starFilledIcon = `<svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
    const starEmptyIcon = `<svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;

    const isMobileView = () => window.innerWidth < 1024;
    
    // --- New Function to Format Price ---
    function formatPrice(lkrPrice) {
        if (selectedCurrency === 'USD') {
            const usdPrice = lkrPrice / LKR_TO_USD_RATE;
            return `$${usdPrice.toFixed(2)}`;
        }
        // Default to LKR
        return `Rs. ${lkrPrice.toLocaleString()}`;
    }

    // --- New Function to handle Currency Selection ---
    function setupCurrencyModal() {
        if (!currencyModal) return;
        const currencyPreferenceSet = sessionStorage.getItem('currencyPreferenceSet');

        if (!currencyPreferenceSet) {
            currencyModal.classList.remove('hidden');
        } else {
            selectedCurrency = sessionStorage.getItem('userCurrency') || 'LKR';
            loadProducts(); // Load products with saved preference
        }

        document.getElementById('select-lkr-btn').addEventListener('click', () => {
            selectedCurrency = 'LKR';
            sessionStorage.setItem('userCurrency', 'LKR');
            sessionStorage.setItem('currencyPreferenceSet', 'true');
            currencyModal.classList.add('hidden');
            loadProducts(); // Reload products with new currency
        });

        document.getElementById('select-usd-btn').addEventListener('click', () => {
            selectedCurrency = 'USD';
            sessionStorage.setItem('userCurrency', 'USD');
            sessionStorage.setItem('currencyPreferenceSet', 'true');
            currencyModal.classList.add('hidden');
            loadProducts(); // Reload products with new currency
        });
    }

    function setupHeroSlider() {
        const swiper = new Swiper('.heroSwiper', {
            loop: true,
            effect: 'fade',
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
        });
    }

    function setupCategoryAutoSlide() {
        const scroller = document.getElementById('category-scroller');
        if (!scroller) return;
        let slideInterval;
        const startSliding = () => {
            slideInterval = setInterval(() => {
                const firstItem = scroller.querySelector('a');
                if (!firstItem) return;
                const scrollAmount = firstItem.offsetWidth + 16;
                let newScrollLeft = scroller.scrollLeft + scrollAmount;
                if (newScrollLeft + scroller.clientWidth >= scroller.scrollWidth) {
                    newScrollLeft = 0;
                }
                scroller.scrollTo({ left: newScrollLeft, behavior: 'smooth' });
            }, 3000);
        };
        const stopSliding = () => clearInterval(slideInterval);
        scroller.addEventListener('mouseenter', stopSliding);
        scroller.addEventListener('mouseleave', startSliding);
        startSliding();
    }

    async function populateFilterOptions() {
        try {
            const staticCategories = [
                "Spices & Herbs",
                "Snacks & Sweets",
                "Ready to Eat",
                "Beverages",
                "Organic Products",
                "Gift Packs"
            ];
            
            const categoryHTML = staticCategories.map(cat => `<label class="flex items-center space-x-2 text-sm cursor-pointer"><input type="checkbox" value="${cat}" class="rounded text-green-600 focus:ring-green-500"><span>${cat}</span></label>`).join('');
            
            document.getElementById('desktop-category-filter-list').innerHTML = categoryHTML || '<p class="text-xs text-gray-400">No categories found.</p>';
            document.getElementById('mobile-category-filter-list').innerHTML = categoryHTML || '<p class="text-xs text-gray-400">No categories found.</p>';
            
        } catch (error) { 
            console.error("Could not populate filters:", error); 
            document.getElementById('desktop-category-filter-list').innerHTML = '<p class="text-xs text-red-500">Error loading categories.</p>';
            document.getElementById('mobile-category-filter-list').innerHTML = '<p class="text-xs text-red-500">Error loading categories.</p>';
        }
    }
    
    function renderDesktopHeaderAndFilters(isFilteredView = false) {
        const headerContainer = document.createElement('div');
        
        if (isFilteredView) {
            const titleRow = document.createElement('div');
            titleRow.className = 'flex items-center justify-between mb-6';
            
            let title = 'Filtered Results';
            const hasOnlyCategoryFilter = currentFilters.categories?.length > 0 && !currentFilters.brands?.length;
            if (hasOnlyCategoryFilter) {
                title = currentFilters.categories.join(' & ');
            }
            
            titleRow.innerHTML = `<h1 class="text-3xl md:text-4xl font-bold text-gray-900">${title}</h1>`;
            
            const sortSelect = document.createElement('select');
            sortSelect.id = 'sort-select';
            sortSelect.className = 'px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-700';
            sortSelect.innerHTML = `<option value="createdAt-desc">Sort by: Newest</option><option value="price-asc">Price: Low to High</option><option value="price-desc">Price: High to Low</option>`;
            sortSelect.value = `${currentSort.field}-${currentSort.direction}`;
            sortSelect.addEventListener('change', (e) => {
                const [field, direction] = e.target.value.split('-');
                currentSort = { field, direction };
                loadProducts();
            });
            titleRow.appendChild(sortSelect);
            headerContainer.appendChild(titleRow);
        }
        return headerContainer;
    }

    function renderMobileHeader() {
        const headerContainer = document.createElement('div');
        headerContainer.className = 'sticky top-0 z-10 bg-white pb-4';
        
        const filterButton = document.createElement('button');
        filterButton.className = 'w-full flex items-center justify-center space-x-2 px-4 py-3 rounded-md font-semibold bg-green-600 text-white hover:bg-green-700 transition-colors';
        filterButton.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg><span>Filter & Sort</span>`;
        filterButton.onclick = () => toggleMobileFilterSidebar(true);
        
        headerContainer.appendChild(filterButton);
        return headerContainer;
    }

    function toggleMobileFilterSidebar(show) {
        if (show) {
            mobileFilterSidebar.classList.remove('hidden');
            setTimeout(() => {
                mobileFilterPanel.classList.remove('-translate-x-full')
                mobileFilterSidebar.addEventListener('click', closeOnOutsideClick, { once: true });
            }, 10);
        } else {
            mobileFilterPanel.classList.add('-translate-x-full');
            setTimeout(() => mobileFilterSidebar.classList.add('hidden'), 300);
        }
    }

    function closeOnOutsideClick(e) {
        if (e.target === mobileFilterSidebar) {
            toggleMobileFilterSidebar(false);
        }
    }
        
    function applyFilters() {
        const sourcePrefix = isMobileView() ? 'mobile' : 'desktop';
        const panel = document.getElementById(`${sourcePrefix}-filter-panel`) || document.getElementById('mobile-filter-panel');
        currentFilters = {};
        currentFilters.categories = [...panel.querySelectorAll(`#${sourcePrefix}-category-filter-list input:checked`)].map(cb => cb.value);
        
        if (isMobileView()) {
            const sortSelect = panel.querySelector('#mobile-sort-select');
            const [field, direction] = sortSelect.value.split('-');
            currentSort = { field, direction };
        }
        
        loadProducts();
    }

    async function loadAndGroupAllProductsDesktop() {
        mainContentArea.innerHTML = `<p class="text-center text-gray-500">Loading...</p>`;
        try {
            const querySnapshot = await getDocs(query(collection(db, "products"), orderBy("createdAt", "desc")));
            mainContentArea.innerHTML = '';
            mainContentArea.appendChild(renderDesktopHeaderAndFilters(false));
            if (querySnapshot.empty) {
                mainContentArea.innerHTML += '<p class="text-center text-gray-500">No products found.</p>'; return;
            }
            const productsByCategory = {};
            querySnapshot.forEach(doc => {
                const product = { id: doc.id, ...doc.data() };
                const category = product.category || 'All Products';
                if (!productsByCategory[category]) productsByCategory[category] = [];
                productsByCategory[category].push(product);
            });
            
            const sortedCategories = Object.keys(productsByCategory).sort((a, b) => {
                if (a === 'All Products') return -1;
                if (b === 'All Products') return 1;
                return a.localeCompare(b);
            });

            for (const category of sortedCategories) {
                const header = document.createElement('h2');
                header.className = 'text-xl font-bold text-gray-800 mb-6 mt-8 border-b pb-2';
                header.textContent = category;
                mainContentArea.appendChild(header);
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-10';
                productsByCategory[category].forEach(p => grid.appendChild(createProductCardElement(p.id, p)));
                mainContentArea.appendChild(grid);
            }
        } catch (error) { console.error("Error loading grouped products:", error); mainContentArea.innerHTML = '<p class="text-center text-red-500">Failed to load products.</p>'; }
    }
    
    async function loadProducts() {
        // Prevent loading products if the currency is not yet selected
        if (!sessionStorage.getItem('currencyPreferenceSet')) {
            mainContentArea.innerHTML = ''; // Keep it empty until choice is made
            return;
        }

        const hasFilters = Object.values(currentFilters).some(val => Array.isArray(val) ? val.length > 0 : val != null);
        mainContentArea.innerHTML = `<p class="text-center text-gray-500">Loading...</p>`;

        try {
            let constraints = [];
            if (hasFilters) {
                if (currentFilters.categories?.length) constraints.push(where("category", "in", currentFilters.categories));
            }
            constraints.push(orderBy(currentSort.field, currentSort.direction));

            const finalQuery = query(collection(db, "products"), ...constraints);
            const querySnapshot = await getDocs(finalQuery);

            if (isMobileView()) {
                mainContentArea.innerHTML = '';
                mainContentArea.appendChild(renderMobileHeader());
                const productGrid = document.createElement('div');
                productGrid.className = 'grid grid-cols-2 gap-x-4 gap-y-8 pt-4';
                mainContentArea.appendChild(productGrid);
                productGrid.innerHTML = ''; // Clear previous results
                if (querySnapshot.empty) {
                    productGrid.innerHTML = `<p class="col-span-full text-center text-gray-500">${hasFilters ? 'No products match.' : 'No products found.'}</p>`;
                } else {
                    querySnapshot.forEach((doc) => productGrid.appendChild(createProductCardElement(doc.id, doc.data())));
                }
            } else { // Desktop view
                if (!hasFilters) {
                    await loadAndGroupAllProductsDesktop();
                } else {
                    mainContentArea.innerHTML = '';
                    mainContentArea.appendChild(renderDesktopHeaderAndFilters(true));
                    const productGrid = document.createElement('div');
                    productGrid.className = 'grid grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-10';
                    mainContentArea.appendChild(productGrid);
                    productGrid.innerHTML = ''; // Clear previous results
                    if (querySnapshot.empty) {
                        productGrid.innerHTML = '<p class="col-span-full text-center text-gray-500">No products match your criteria.</p>';
                    } else {
                        querySnapshot.forEach((doc) => productGrid.appendChild(createProductCardElement(doc.id, doc.data())));
                    }
                }
            }
        } catch (error) {
            console.error("Error loading products:", error);
            mainContentArea.innerHTML = '<p class="col-span-full text-center text-red-500">Could not load products. Please check console.</p>';
        }
    }
    
    function generateStars(rating = 0) {
        let starsHTML = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                starsHTML += starFilledIcon;
            } else {
                starsHTML += starEmptyIcon;
            }
        }
        return starsHTML;
    }

    function createProductCardElement(productId, product) {
        const cardWrapper = document.createElement('div');
        const isWishlisted = wishlistedProductIds.has(productId);
        const displayImage = product.imageUrl || 'https://placehold.co/400x500/f0f0f0/666?text=No+Image';

        const rating = product.rating || (Math.random() * 2 + 3).toFixed(1);
        const reviewCount = product.reviewCount || Math.floor(Math.random() * 50) + 1;
        const oldPrice = product.oldPrice || product.price * 1.25;
        
        const displayPrice = formatPrice(product.price);
        const displayOldPrice = formatPrice(oldPrice);

        cardWrapper.innerHTML = `
            <div class="group relative overflow-hidden rounded-lg bg-white border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                <a href="product-detail.html?id=${productId}">
                    <img src="${displayImage}" alt="${product.name}" class="w-full h-auto aspect-[3/4] object-cover object-center group-hover:scale-105 transition-transform duration-300">
                </a>
                <button class="wishlist-btn absolute top-2 right-2 p-2 rounded-full bg-white/80 backdrop-blur-sm text-gray-700 hover:text-red-500 transition-colors" data-product-id="${productId}">
                    ${isWishlisted ? heartIconFilled : heartIconEmpty}
                </button>
            </div>
            <div class="mt-3 px-1">
                <a href="product-detail.html?id=${productId}" class="text-sm font-semibold text-gray-800 hover:text-green-700 transition-colors">${product.name}</a>
                <div class="flex items-center mt-1">
                    ${generateStars(rating)}
                    <span class="text-xs text-gray-500 ml-2">(${reviewCount})</span>
                </div>
                <div class="mt-2 flex items-baseline gap-2">
                    <p class="text-lg font-bold text-gray-900">${displayPrice}</p>
                    <p class="text-sm text-gray-500 line-through">${displayOldPrice}</p>
                </div>
            </div>`;
        return cardWrapper;
    }

    function updateAllWishlistIcons() {
        document.querySelectorAll('.wishlist-btn').forEach(btn => {
            const productId = btn.dataset.productId;
            const isWishlisted = wishlistedProductIds.has(productId);
            btn.innerHTML = isWishlisted ? heartIconFilled : heartIconEmpty;
        });
    }

    async function toggleWishlistItem(productId) {
        const user = auth.currentUser;
        if (!user) { authModal.classList.remove('hidden'); return; }
        const wishlistRef = doc(db, 'wishlists', user.uid, 'items', productId);
        try {
            if (wishlistedProductIds.has(productId)) {
                await deleteDoc(wishlistRef);
            } else {
                const productRef = doc(db, 'products', productId);
                const productSnap = await getDoc(productRef);
                if (productSnap.exists()) {
                    await setDoc(wishlistRef, { ...productSnap.data(), addedAt: new Date() });
                }
            }
        } catch (error) { console.error("Error updating wishlist:", error); }
    }

    onAuthStateChanged(auth, user => {
        if (user) {
            listenToUserData(user.uid);
            userText.textContent = "My Account";
        } else {
            if (wishlistListener) wishlistListener();
            if (cartListener) cartListener();
            wishlistedProductIds.clear();
            updateAllWishlistIcons();
            const cartCountEl = document.getElementById('cart-count');
            cartCountEl.textContent = '0';
            cartCountEl.classList.add('hidden');
            userText.textContent = "Log in / Register";
        }
    });

    function listenToUserData(userId) {
        const wishlistRef = collection(db, 'wishlists', userId, 'items');
        wishlistListener = onSnapshot(wishlistRef, snapshot => {
            wishlistedProductIds = new Set(snapshot.docs.map(doc => doc.id));
            updateAllWishlistIcons();
        });
        const cartRef = collection(db, 'carts', userId, 'items');
        cartListener = onSnapshot(cartRef, snapshot => {
            const count = snapshot.size;
            const cartCountEl = document.getElementById('cart-count');
            cartCountEl.textContent = count;
            cartCountEl.classList.toggle('hidden', count === 0);
        });
    }

    function setupAuthModal() {
        const loginTab = authModal.querySelector('#login-tab');
        const signupTab = authModal.querySelector('#signup-tab');
        const loginForm = authModal.querySelector('#login-form');
        const signupForm = authModal.querySelector('#signup-form');
        const googleBtn = authModal.querySelector('#google-signin-btn');
        const authError = authModal.querySelector('#auth-error');
        const userEmailDisplay = userInfoModal.querySelector('#user-email-display');
        const logoutButton = userInfoModal.querySelector('#logout-button');
        const closeUserModal = userInfoModal.querySelector('#close-user-modal');

        userButton.addEventListener('click', () => {
            if (auth.currentUser) {
                userEmailDisplay.textContent = auth.currentUser.email;
                userInfoModal.classList.remove('hidden');
            } else {
                authModal.classList.remove('hidden');
            }
        });
        authModal.addEventListener('click', e => { if (e.target === authModal) authModal.classList.add('hidden'); });
        userInfoModal.addEventListener('click', e => { if (e.target === userInfoModal) userInfoModal.classList.add('hidden'); });
        closeUserModal.addEventListener('click', () => userInfoModal.classList.add('hidden'));

        loginTab.addEventListener('click', () => {
            loginTab.classList.replace('bg-white', 'bg-gray-100');
            signupTab.classList.replace('bg-gray-100', 'bg-white');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        });
        signupTab.addEventListener('click', () => {
            signupTab.classList.replace('bg-white', 'bg-gray-100');
            loginTab.classList.replace('bg-gray-100', 'bg-white');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });

        loginForm.addEventListener('submit', async e => {
            e.preventDefault(); authError.textContent = '';
            try {
                await signInWithEmailAndPassword(auth, loginForm['login-email'].value, loginForm['login-password'].value);
                authModal.classList.add('hidden');
            } catch (error) { authError.textContent = error.message; }
        });
        signupForm.addEventListener('submit', async e => {
            e.preventDefault(); authError.textContent = '';
            try {
                await createUserWithEmailAndPassword(auth, signupForm['signup-email'].value, signupForm['signup-password'].value);
                authModal.classList.add('hidden');
            } catch (error) { authError.textContent = error.message; }
        });
        googleBtn.addEventListener('click', async () => {
            authError.textContent = '';
            try {
                await signInWithPopup(auth, new GoogleAuthProvider());
                authModal.classList.add('hidden');
            } catch (error) { authError.textContent = error.message; }
        });
        logoutButton.addEventListener('click', async () => {
            await signOut(auth);
            userInfoModal.classList.add('hidden');
        });
    }

    document.addEventListener('DOMContentLoaded', async () => {
        setupAuthModal();
        setupCurrencyModal();
        
        await populateFilterOptions();
        
        setupHeroSlider();
        setupCategoryAutoSlide();
        
        const searchHandler = (e) => {
            e.preventDefault();
            const input = e.target.querySelector('input');
            const searchTerm = input.value.trim();
            if (searchTerm) {
                alert(`You searched for: ${searchTerm}`);
            }
        };

        document.getElementById('desktop-search-form').addEventListener('submit', searchHandler);
        document.getElementById('mobile-search-form').addEventListener('submit', searchHandler);

        document.getElementById('desktop-filter-panel').addEventListener('change', applyFilters);
        mobileFilterPanel.addEventListener('change', (e) => {
            if (e.target.matches('input[type="checkbox"]') || e.target.matches('select')) {
                applyFilters();
            }
        });

        closeFilterBtn.addEventListener('click', () => toggleMobileFilterSidebar(false));
        mainContentArea.addEventListener('click', e => {
            const wishlistBtn = e.target.closest('.wishlist-btn');
            if (wishlistBtn) toggleWishlistItem(wishlistBtn.dataset.productId);
        });

        // --- WhatsApp Contact Form ---
        const contactForm = document.getElementById('contact-form');
        contactForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;

            if (name && email && message) {
                const whatsappNumber = "94779004063"; // Your WhatsApp number with country code, without '+'
                const fullMessage = `Hello, I'm ${name} (${email}).\n\nMessage:\n${message}`;
                const encodedMessage = encodeURIComponent(fullMessage);
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
            } else {
                alert('Please fill out all fields before sending a message.');
            }
        });

        
        // --- Achievements/Goals Swiper with YouTube Player ---
        let youtubePlayer;
        let goalsSwiperInstance;

        window.onYouTubeIframeAPIReady = function() {
            youtubePlayer = new YT.Player('youtube-player', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange 
                }
            });
        }

        function onPlayerReady(event) {
            event.target.mute(); 
            if (goalsSwiperInstance && goalsSwiperInstance.slides[goalsSwiperInstance.activeIndex].classList.contains('youtube-slide')) {
                event.target.playVideo();
                goalsSwiperInstance.autoplay.stop();
            }
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
                if(goalsSwiperInstance) {
                    goalsSwiperInstance.slideNext();
                }
            }
        }

        goalsSwiperInstance = new Swiper('.goals-swiper', {
            loop: true,
            effect: 'fade',
            autoHeight: true,
            fadeEffect: {
                crossFade: true
            },
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.goals-swiper .swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.goals-swiper .swiper-button-next',
                prevEl: '.goals-swiper .swiper-button-prev',
            },
            on: {
                init: function() {
                    const descriptionEl = document.getElementById('dynamic-achievement-description');
                    const initialSlide = this.slides[this.activeIndex];
                    const description = initialSlide.getAttribute('data-description');
                    if (description && descriptionEl) {
                        descriptionEl.innerText = description;
                    }
                },
                slideChange: function() {
                    const descriptionEl = document.getElementById('dynamic-achievement-description');
                    const activeSlide = this.slides[this.activeIndex];
                    const description = activeSlide.getAttribute('data-description');
                    if (description && descriptionEl) {
                        descriptionEl.innerText = description;
                    }

                    if (youtubePlayer && typeof youtubePlayer.pauseVideo === 'function') {
                         if (activeSlide.classList.contains('youtube-slide')) {
                             this.autoplay.stop();
                             youtubePlayer.seekTo(0);
                             youtubePlayer.playVideo();
                         } else {
                             this.autoplay.start();
                             youtubePlayer.pauseVideo();
                         }
                    }
                }
            }
        });
    });
</script>

<div id="currency-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
        <h2 class="text-xl font-bold text-gray-800 mb-2">Welcome!</h2>
        <p class="text-gray-600 mb-6">Please select your location to continue.</p>
        <div class="space-y-3">
            <button id="select-lkr-btn" class="w-full bg-green-700 text-white font-bold py-3 rounded-md hover:bg-green-800 transition">
                Sri Lanka (LKR)
            </button>
            <button id="select-usd-btn" class="w-full bg-gray-700 text-white font-bold py-3 rounded-md hover:bg-gray-800 transition">
                Other Country (USD)
            </button>
        </div>
    </div>
</div>

</body>
</html>