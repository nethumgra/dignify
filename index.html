<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dignify Ceylon - Authentic BM Foods</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Galada&display=swap" rel="stylesheet">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
        }

        /* DIV 1: The Background Layer - Updated for a single, large image */
        #page-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('https://i.ibb.co/Gfg6DS3V/a-HR0c-HM6-Ly9l-Ln-N0-YWVkd-Gxlcm-Nkbi5j.png');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center center;
            opacity: 0.05; /* Slightly increased opacity */
            z-index: 1; /* Layer 1 */
        }

        /* DIV 2: The Content Layer */
        #content-wrapper {
            position: relative;
            z-index: 1;
           
        }
        
        .font-brand {
            font-family: 'Galada', cursive;
        }

        .sidebar-panel { transition: transform 0.3s ease-in-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 5px;}
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
        .tab-panel { display: none; }
        .tab-panel.active { display: grid; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .no-scroll {
            overflow: hidden;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #16a34a; /* green-600 */
        }
    </style>
</head>
<body class="text-gray-800">

<div id="page-background"></div>

<div id="content-wrapper">

    <div class="bg-green-900 text-white text-center py-2 text-sm">
        Free Island-wide Delivery on Orders Over Rs. 5000!
    </div>

    <nav class="bg-white text-gray-800 px-4 py-4 sticky top-0 z-40 shadow-sm border-b">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <a href="index.html" class="font-brand text-3xl tracking-wider text-green-800">Dignify Ceylon</a>
            </div>
    
            <div class="hidden lg:flex flex-grow max-w-xl mx-8">
                <form id="desktop-search-form" class="w-full flex items-center border border-gray-300 rounded-md">
                    <div class="relative">
                        <select class="pl-4 pr-8 py-2 bg-gray-100 rounded-l-md border-r border-gray-300 text-sm focus:outline-none appearance-none">
                            <option>All</option>
                            <option>Spices & Herbs</option>
                            <option>Snacks & Sweets</option>
                            <option>Ready to Eat</option>
                            <option>Beverages</option>
                        </select>
                    </div>
                    <input type="text" id="desktop-search-input" placeholder="Search for spices, snacks..." class="w-full py-2 px-4 text-gray-900 placeholder-gray-500 focus:outline-none">
                    <button type="submit" class="px-6 py-2 bg-green-700 text-white font-semibold rounded-r-md hover:bg-green-800">
                        Search
                    </button>
                </form>
            </div>
    
            <div class="flex items-center space-x-6">
                <a href="cart.html" id="cart-button" class="flex items-center gap-2 hover:text-green-600 relative">
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.658-.463 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-amber-400 text-black text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center border-2 border-white">0</span>
                </a>
                 <button id="user-button" class="flex items-center gap-2 hover:text-green-600">
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                    <span id="user-text" class="text-sm hidden md:block">Log in / Register</span>
                </button>
            </div>
        </div>
    
        <div class="mt-3 lg:hidden">
            <form id="mobile-search-form" class="w-full">
                <div class="relative">
                    <input type="text" id="mobile-search-input" placeholder="Search for spices, snacks..." class="w-full py-2 pl-4 pr-12 rounded-md text-gray-900 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button type="submit" class="absolute inset-y-0 right-0 flex items-center px-4 bg-green-700 rounded-r-md">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                </div>
            </form>
        </div>
    </nav>
    
    <header class="relative bg-gray-800">
        <div class="swiper hero-slider h-[60vh]">
            <div class="swiper-wrapper">
                
              

                <div class="swiper-slide">
                    <a href="/organic-products">
                        <img class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1920&auto=format&fit=crop" alt="Fresh organic products from local sources">
                    </a>
                </div>

            </div>
            <div class="swiper-pagination"></div>
        </div>
    </header>


    <section class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="flex items-center gap-4">
                    <img src="https://img.icons8.com/ios/50/22c55e/restaurant.png" alt="Authentic Flavours" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Authentic Flavours</h3>
                        <p class="text-sm text-gray-600">Taste the tradition.</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                     <img src="https://img.icons8.com/ios/50/22c55e/sprout.png" alt="Freshly Packed" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Freshly Packed</h3>
                        <p class="text-sm text-gray-600">Sealed for freshness.</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <img src="https://img.icons8.com/ios/50/22c55e/box.png" alt="Secure Packaging" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Secure Packaging</h3>
                        <p class="text-sm text-gray-600">Delivered safe and sound.</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <img src="https://img.icons8.com/ios/50/22c55e/cash-on-delivery.png" alt="Cash on Delivery" class="w-12 h-12"/>
                    <div>
                        <h3 class="font-bold text-gray-800">Cash on Delivery</h3>
                        <p class="text-sm text-gray-600">Pay at your doorstep.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="pb-9">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div id="category-scroller" class="flex space-x-4 overflow-x-auto snap-x snap-mandatory no-scrollbar p-2">
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/kVGmH1JR/2.jpg" alt="Spices & Herbs" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/35NXqLTj/1.jpg" alt="Snacks & Sweets" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/tTnJQM1q/3.jpg" alt="Ready to Eat" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/twZsNQmb/4.jpg" alt="Beverages" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/0RLsGDty/5.jpg" alt="Organic Products" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
            <a href="#" class="group relative block aspect-square flex-shrink-0 w-2/5 md:w-1/4 lg:w-1/5 snap-start">
                <img src="https://i.ibb.co/xKyhBNm2/BEET-ROOT-PASTA.png" alt="Gift Packs" class="w-full h-full object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-4 rounded-md group-hover:bg-opacity-30 transition">
                </div>
            </a>
            
        </div>
    </div>
</section>
    
    <div id="product-grid-container" class="max-w-7xl mx-auto px-4 pt-3 pb-16">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-x-8">
            <aside id="desktop-filter-panel" class="hidden lg:block lg:col-span-1">
                <div class="space-y-8 sticky top-28">
                    <div class="border-b pb-6">
                        <h3 class="font-semibold mb-4 text-lg">Brand</h3>
                        <input type="text" id="desktop-brand-search" placeholder="Search Brand" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm mb-3">
                        <div id="desktop-brand-filter-list" class="space-y-2">
                            <p class="text-xs text-gray-400">Loading brands...</p>
                        </div>
                    </div>
                    <div class="border-b pb-6">
                        <h3 class="font-semibold mb-4 text-lg">Category</h3>
                        <div id="desktop-category-filter-list" class="space-y-2"><p class="text-xs text-gray-400">Loading categories...</p></div>
                    </div>
                    <div class="border-t pt-6">
                         <h3 class="font-semibold mb-2 text-lg">Price Range</h3>
                         <div class="flex items-center space-x-2">
                              <input type="number" id="desktop-min-price" placeholder="Min" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" min="0">
                              <span class="text-gray-500">-</span>
                              <input type="number" id="desktop-max-price" placeholder="Max" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" min="0">
                         </div>
                    </div>
                    <div class="pt-4 flex flex-col space-y-2">
                         <button id="desktop-apply-filters-btn" class="w-full bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">Apply</button>
                         <button id="desktop-clear-filters-btn" class="w-full bg-gray-200 text-gray-800 font-bold py-2.5 rounded-md hover:bg-gray-300 transition">Clear All</button>
                    </div>
                </div>
            </aside>

            <main class="lg:col-span-3 h-[calc(100vh-15rem)] lg:h-[calc(100vh-8rem)] overflow-y-auto no-scrollbar">
                <div id="main-content-area">
                    <p class="col-span-full text-center text-gray-500 text-lg">Loading...</p>
                </div>
            </main>
        </div>
    </div>
    
    <div id="mobile-filter-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden lg:hidden">
        <div id="mobile-filter-panel" class="sidebar-panel absolute top-0 left-0 h-full w-full max-w-sm bg-white shadow-xl transform -translate-x-full flex flex-col">
            <div class="flex items-center justify-between p-4 border-b">
                <h2 class="text-lg font-semibold">Filters</h2>
                <button id="close-filter-btn" class="p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>
            <div class="p-4 space-y-6 overflow-y-auto flex-grow custom-scrollbar">
                <div>
                    <h3 class="font-semibold mb-2">Brand</h3>
                    <input type="text" id="mobile-brand-search" placeholder="Search Brand" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm mb-3">
                    <div id="mobile-brand-filter-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                </div>
                <div>
                    <h3 class="font-semibold mb-1">Category</h3>
                    <div id="mobile-category-filter-list" class="space-y-2"></div>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Price Range</h3>
                    <div class="flex items-center space-x-2">
                        <input type="number" id="mobile-min-price" placeholder="Min" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" min="0">
                        <span class="text-gray-500">-</span>
                        <input type="number" id="mobile-max-price" placeholder="Max" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" min="0">
                    </div>
                </div>
            </div>
            <div class="p-4 border-t bg-white flex space-x-2">
                <button id="mobile-clear-filters-btn" class="w-1/2 bg-gray-200 text-gray-800 font-bold py-2.5 rounded-md hover:bg-gray-300 transition">Clear All</button>
                <button id="mobile-apply-filters-btn" class="w-1/2 bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">Apply</button>
            </div>
        </div>
    </div>

    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
         <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
              <div class="flex border-b">
                   <button id="login-tab" class="flex-1 py-3 font-semibold text-center bg-gray-100 text-gray-800 rounded-tl-lg">Login</button>
                   <button id="signup-tab" class="flex-1 py-3 font-semibold text-center bg-white text-gray-500">Sign Up</button>
              </div>
              <div class="p-8">
                   <form id="login-form" class="space-y-4">
                        <div>
                             <label for="login-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                             <input type="email" id="login-email" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                             <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                             <input type="password" id="login-password" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">Login</button>
                   </form>
                   <form id="signup-form" class="space-y-4 hidden">
                        <div>
                             <label for="signup-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                             <input type="email" id="signup-email" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                             <label for="signup-password" class="block text-sm font-medium text-gray-700">Password</label>
                             <input type="password" id="signup-password" minlength="6" required class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                             <p class="text-xs text-gray-500 mt-1">Must be at least 6 characters long.</p>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">Create Account</button>
                   </form>
                   <div class="relative flex py-5 items-center">
                        <div class="flex-grow border-t border-gray-200"></div>
                        <span class="flex-shrink mx-4 text-xs text-gray-400 uppercase">Or</span>
                        <div class="flex-grow border-t border-gray-200"></div>
                   </div>
                   <button id="google-signin-btn" class="w-full flex items-center justify-center py-2.5 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">
                        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"></path><path fill="#FF3D00" d="m6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"></path><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.223 0-9.641-3.657-11.297-8.591l-6.522 5.025C9.505 39.556 16.227 44 24 44z"></path><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.574l6.19 5.238C42.012 35.245 44 30.024 44 24c0-1.341-.138-2.65-.389-3.917z"></path></svg>
                        Sign in with Google
                   </button>
                   <p id="auth-error" class="text-red-500 text-sm mt-4 text-center"></p>
              </div>
         </div>
    </div>
    
    <div id="user-info-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
            <h2 class="text-lg font-medium text-gray-900">Welcome!</h2>
            <p id="user-email-display" class="mt-2 text-sm text-gray-600 truncate"></p>
            <a href="my-orders.html" id="my-orders-button" class="mt-4 w-full block bg-green-600 text-white font-bold py-2.5 rounded-md hover:bg-green-700 transition">My Orders</a>
            <button id="logout-button" class="mt-2 w-full bg-red-600 text-white font-bold py-2.5 rounded-md hover:bg-red-700 transition">Logout</button>
            <button id="close-user-modal" class="mt-2 w-full text-gray-600 text-sm py-2">Close</button>
        </div>
    </div>

     <section class="py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
            <div>
                <img src="https://i.ibb.co/k2cvwnfQ/DIGNIFY-CEYLON.jpg" alt="Hands holding authentic Sri Lankan spices" class="rounded-lg shadow-2xl w-full h-full object-cover">
            </div>
            <div class="space-y-4">
                <h2 class="text-3xl font-bold text-gray-800 tracking-tight">Our Story: The Essence of Ceylon</h2>
                <p class="text-gray-600 leading-relaxed">
                    Born from a passion for authentic Sri Lankan flavors, Dignify Ceylon is more than just a brand; it's a promise of quality and tradition. We began our journey to bring the true taste of our island's rich culinary heritage to every home, ensuring that every meal is a celebration.
                </p>
                <p class="text-gray-600 leading-relaxed">
                    We work directly with local farmers to source the freshest, highest-quality ingredients. Each product is prepared with care, following age-old recipes to preserve the natural goodness and authentic taste that you love. From our spices to our ready-to-eat meals, we bring you the heart of Ceylon's cuisine.
                </p>
            </div>
        </div>
    </section>

    
    
    <footer class="bg-green-900 text-white">
        <div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-brand text-2xl mb-4">Dignify Ceylon</h3>
                    <p class="text-gray-400 text-sm">
                        Discover authentic Sri Lankan flavours with Dignify Ceylon. Quality ingredients, freshly packed for your home.
                    </p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Shop</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-white">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Spices</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Snacks</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Beverages</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Help</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Shipping & Returns</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Stay Connected</h3>
                    <p class="text-gray-400 text-sm mb-3">Get exclusive deals and updates straight to your inbox.</p>
                    <form class="flex">
                        <input type="email" placeholder="Your Email" class="w-full rounded-l-md py-2 px-3 text-gray-800 focus:outline-none">
                        <button type="submit" class="bg-green-700 hover:bg-green-800 rounded-r-md px-4 py-2 font-semibold">Go</button>
                    </form>
                    <div class="flex space-x-4 mt-6">
                        <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0h-21.35C.59 0 0 .59 0 1.325v21.351C0 23.41.59 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116c.735 0 1.325-.59 1.325-1.325V1.325C24 .59 23.41 0 22.675 0z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616v.064c0 2.294 1.634 4.208 3.803 4.649-.623.169-1.272.23-1.933.23-.3 0-.594-.029-.884-.084.618 1.884 2.408 3.258 4.533 3.3-1.625 1.27-3.673 2.022-5.904 2.022-.383 0-.76-.022-1.13-.066 2.099 1.353 4.606 2.148 7.321 2.148 8.778 0 13.59-7.278 13.59-13.59 0-.205-.005-.409-.013-.612.932-.672 1.738-1.512 2.379-2.465z"></path></svg></a>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-green-800 text-center text-sm text-gray-400">
                <p>&copy; 2025 Dignify Ceylon. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, where, onSnapshot, doc, setDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- Firebase Config ---
      const firebaseConfig = {
            apiKey: "AIzaSyCpLC89l1EV_o399HEH_qppqecedVAhmdE",
            authDomain: "dignify-69351.firebaseapp.com",
            projectId: "dignify-69351",
            storageBucket: "dignify-69351.appspot.com",
            messagingSenderId: "141142153545",
            appId: "1:141142153545:web:c464f04b452206d1456298",
            measurementId: "G-FV52NPV5Q4"
        };
        
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    // --- DOM Elements ---
    const mainContentArea = document.getElementById('main-content-area');
    const userButton = document.getElementById('user-button');
    const mobileFilterSidebar = document.getElementById('mobile-filter-sidebar');
    const mobileFilterPanel = document.getElementById('mobile-filter-panel');
    const closeFilterBtn = document.getElementById('close-filter-btn');
    const authModal = document.getElementById('auth-modal');
    const userInfoModal = document.getElementById('user-info-modal');
    const userText = document.getElementById('user-text');
    
    // --- Global State ---
    let currentFilters = {};
    let currentSort = { field: 'createdAt', direction: 'desc' };
    let wishlistedProductIds = new Set();
    let cartListener = null;
    let wishlistListener = null;

    // --- Icons ---
    const heartIconEmpty = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg>`;
    const heartIconFilled = `<svg class="w-6 h-6" fill="currentColor" class="text-red-500" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>`;
    const starFilledIcon = `<svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
    const starEmptyIcon = `<svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;

    const isMobileView = () => window.innerWidth < 1024;

    function setupHeroSlider() {
        const swiper = new Swiper('.hero-slider', {
            loop: true,
            effect: 'fade',
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
        });
    }

    function setupCategoryAutoSlide() {
        const scroller = document.getElementById('category-scroller');
        if (!scroller) return;
        let slideInterval;
        const startSliding = () => {
            slideInterval = setInterval(() => {
                const firstItem = scroller.querySelector('a');
                if (!firstItem) return;
                const scrollAmount = firstItem.offsetWidth + 16;
                let newScrollLeft = scroller.scrollLeft + scrollAmount;
                if (newScrollLeft + scroller.clientWidth >= scroller.scrollWidth) {
                    newScrollLeft = 0;
                }
                scroller.scrollTo({ left: newScrollLeft, behavior: 'smooth' });
            }, 3000);
        };
        const stopSliding = () => clearInterval(slideInterval);
        scroller.addEventListener('mouseenter', stopSliding);
        scroller.addEventListener('mouseleave', startSliding);
        startSliding();
    }

    async function populateFilterOptions() {
        try {
            const productsSnapshot = await getDocs(collection(db, "products"));
            const allProducts = productsSnapshot.docs.map(doc => doc.data());
            
            const brands = [...new Set(allProducts.map(p => p.brand).filter(Boolean))].sort();
            const brandHTML = brands.map(brand => `<label class="flex items-center space-x-2 text-sm cursor-pointer"><input type="checkbox" value="${brand}" class="rounded text-green-600 focus:ring-green-500"><span>${brand}</span></label>`).join('');
            document.getElementById('desktop-brand-filter-list').innerHTML = brandHTML || '<p class="text-xs text-gray-400">No brands found.</p>';
            document.getElementById('mobile-brand-filter-list').innerHTML = brandHTML || '<p class="text-xs text-gray-400">No brands found.</p>';

            const staticCategories = [
                "Spices & Herbs",
                "Snacks & Sweets",
                "Ready to Eat",
                "Beverages",
                "Organic Products",
                "Gift Packs"
            ];
            
            const categoryHTML = staticCategories.map(cat => `<label class="flex items-center space-x-2 text-sm cursor-pointer"><input type="checkbox" value="${cat}" class="rounded text-green-600 focus:ring-green-500"><span>${cat}</span></label>`).join('');
            
            document.getElementById('desktop-category-filter-list').innerHTML = categoryHTML || '<p class="text-xs text-gray-400">No categories found.</p>';
            document.getElementById('mobile-category-filter-list').innerHTML = categoryHTML || '<p class="text-xs text-gray-400">No categories found.</p>';
            
        } catch (error) { 
            console.error("Could not populate filters:", error); 
            document.getElementById('desktop-category-filter-list').innerHTML = '<p class="text-xs text-red-500">Error loading categories.</p>';
            document.getElementById('mobile-category-filter-list').innerHTML = '<p class="text-xs text-red-500">Error loading categories.</p>';
        }
    }
    
    function renderDesktopHeaderAndFilters(isFilteredView = false) {
        const headerContainer = document.createElement('div');
        
        if (isFilteredView) {
            const titleRow = document.createElement('div');
            titleRow.className = 'flex items-center justify-between mb-6';
            
            let title = 'Filtered Results';
            const hasOnlyCategoryFilter = currentFilters.categories?.length > 0 && !currentFilters.brands?.length && currentFilters.minPrice == null && currentFilters.maxPrice == null;
            if (hasOnlyCategoryFilter) {
                title = currentFilters.categories.join(' & ');
            }
            
            titleRow.innerHTML = `<h1 class="text-3xl md:text-4xl font-bold text-gray-900">${title}</h1>`;
            
            const sortSelect = document.createElement('select');
            sortSelect.id = 'sort-select';
            sortSelect.className = 'px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-700';
            sortSelect.innerHTML = `<option value="createdAt-desc">Sort by: Newest</option><option value="price-asc">Price: Low to High</option><option value="price-desc">Price: High to Low</option>`;
            sortSelect.value = `${currentSort.field}-${currentSort.direction}`;
            sortSelect.addEventListener('change', (e) => {
                const [field, direction] = e.target.value.split('-');
                currentSort = { field, direction };
                loadProducts();
            });
            titleRow.appendChild(sortSelect);
            headerContainer.appendChild(titleRow);
        }
        return headerContainer;
    }

    function renderMobileHeader() {
        const headerContainer = document.createElement('div');
        headerContainer.className = 'sticky top-0 z-10 bg-white pb-4';
        
        const filterButton = document.createElement('button');
        filterButton.className = 'w-full flex items-center justify-center space-x-2 px-4 py-3 rounded-md font-semibold bg-green-600 text-white hover:bg-green-700 transition-colors';
        filterButton.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg><span>Filter & Sort</span>`;
        filterButton.onclick = () => toggleMobileFilterSidebar(true);
        
        headerContainer.appendChild(filterButton);
        return headerContainer;
    }

    function toggleMobileFilterSidebar(show) {
        if (show) {
            mobileFilterSidebar.classList.remove('hidden');
            setTimeout(() => mobileFilterPanel.classList.remove('-translate-x-full'), 10);
        } else {
            mobileFilterPanel.classList.add('-translate-x-full');
            setTimeout(() => mobileFilterSidebar.classList.add('hidden'), 300);
        }
    }
        
    function applyFilters() {
        const sourcePrefix = isMobileView() ? 'mobile' : 'desktop';
        const panel = document.getElementById(`${sourcePrefix}-filter-panel`);
        currentFilters = {};
        currentFilters.brands = [...panel.querySelectorAll(`#${sourcePrefix}-brand-filter-list input:checked`)].map(cb => cb.value);
        currentFilters.categories = [...panel.querySelectorAll(`#${sourcePrefix}-category-filter-list input:checked`)].map(cb => cb.value);
        const minPrice = parseFloat(panel.querySelector(`#${sourcePrefix}-min-price`).value);
        if (!isNaN(minPrice)) currentFilters.minPrice = minPrice; else delete currentFilters.minPrice;
        const maxPrice = parseFloat(panel.querySelector(`#${sourcePrefix}-max-price`).value);
        if (!isNaN(maxPrice)) currentFilters.maxPrice = maxPrice; else delete currentFilters.maxPrice;
        if (isMobileView()) toggleMobileFilterSidebar(false);
        loadProducts();
    }

    function clearFilters() {
        currentFilters = {};
        loadProducts();
    }
    
    function updateFilterUIs() {
        ['mobile', 'desktop'].forEach(view => {
            const panel = document.getElementById(`${view}-filter-panel`);
            if (!panel) return;
            panel.querySelector(`#${view}-min-price`).value = currentFilters.minPrice || '';
            panel.querySelector(`#${view}-max-price`).value = currentFilters.maxPrice || '';
            panel.querySelectorAll('input[type="checkbox"]').forEach(cb => { cb.checked = false; });
            if (currentFilters.brands) currentFilters.brands.forEach(b => {
                const el = panel.querySelector(`input[value="${b}"]`); if(el) el.checked = true;
            });
            if (currentFilters.categories) currentFilters.categories.forEach(c => {
                 const el = panel.querySelector(`input[value="${c}"]`); if(el) el.checked = true;
            });
        });
    }

    async function loadAndGroupAllProductsDesktop() {
        mainContentArea.innerHTML = `<p class="text-center text-gray-500">Loading...</p>`;
        try {
            const querySnapshot = await getDocs(query(collection(db, "products"), orderBy("createdAt", "desc")));
            mainContentArea.innerHTML = '';
            mainContentArea.appendChild(renderDesktopHeaderAndFilters(false));
            if (querySnapshot.empty) {
                mainContentArea.innerHTML += '<p class="text-center text-gray-500">No products found.</p>'; return;
            }
            const productsByCategory = {};
            querySnapshot.forEach(doc => {
                const product = { id: doc.id, ...doc.data() };
                const category = product.category || 'All Products';
                if (!productsByCategory[category]) productsByCategory[category] = [];
                productsByCategory[category].push(product);
            });
            
            const sortedCategories = Object.keys(productsByCategory).sort((a, b) => {
                if (a === 'All Products') return -1;
                if (b === 'All Products') return 1;
                return a.localeCompare(b);
            });

            for (const category of sortedCategories) {
                const header = document.createElement('h2');
                header.className = 'text-xl font-bold text-gray-800 mb-6 mt-8 border-b pb-2';
                header.textContent = category;
                mainContentArea.appendChild(header);
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-10';
                productsByCategory[category].forEach(p => grid.appendChild(createProductCardElement(p.id, p)));
                mainContentArea.appendChild(grid);
            }
        } catch (error) { console.error("Error loading grouped products:", error); mainContentArea.innerHTML = '<p class="text-center text-red-500">Failed to load products.</p>'; }
    }
    
    async function loadProducts() {
        const hasFilters = Object.values(currentFilters).some(val => Array.isArray(val) ? val.length > 0 : val != null);
        mainContentArea.innerHTML = `<p class="text-center text-gray-500">Loading...</p>`;

        if (isMobileView()) {
            mainContentArea.innerHTML = '';
            mainContentArea.appendChild(renderMobileHeader());
            const productGrid = document.createElement('div');
            productGrid.className = 'grid grid-cols-2 gap-x-4 gap-y-8 pt-4';
            mainContentArea.appendChild(productGrid);
            let constraints = [];
            if (hasFilters) {
                if (currentFilters.brands?.length) constraints.push(where("brand", "in", currentFilters.brands));
                if (currentFilters.categories?.length) constraints.push(where("category", "in", currentFilters.categories));
                if (currentFilters.minPrice != null) constraints.push(where("price", ">=", currentFilters.minPrice));
                if (currentFilters.maxPrice != null) constraints.push(where("price", "<=", currentFilters.maxPrice));
            }
            constraints.push(orderBy(currentSort.field, currentSort.direction));
            const finalQuery = query(collection(db, "products"), ...constraints);
            const querySnapshot = await getDocs(finalQuery);
            productGrid.innerHTML = '';
            if (querySnapshot.empty) {
                productGrid.innerHTML = `<p class="col-span-full text-center text-gray-500">${hasFilters ? 'No products match.' : 'No products found.'}</p>`;
            } else {
                querySnapshot.forEach((doc) => productGrid.appendChild(createProductCardElement(doc.id, doc.data())));
            }
        } else {
            if (!hasFilters) {
                await loadAndGroupAllProductsDesktop();
            } else {
                mainContentArea.innerHTML = '';
                mainContentArea.appendChild(renderDesktopHeaderAndFilters(true));
                const productGrid = document.createElement('div');
                productGrid.className = 'grid grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-10';
                mainContentArea.appendChild(productGrid);
                let constraints = [];
                if (currentFilters.brands?.length) constraints.push(where("brand", "in", currentFilters.brands));
                if (currentFilters.categories?.length) constraints.push(where("category", "in", currentFilters.categories));
                if (currentFilters.minPrice != null) constraints.push(where("price", ">=", currentFilters.minPrice));
                if (currentFilters.maxPrice != null) constraints.push(where("price", "<=", currentFilters.maxPrice));
                constraints.push(orderBy(currentSort.field, currentSort.direction));
                const finalQuery = query(collection(db, "products"), ...constraints);
                const querySnapshot = await getDocs(finalQuery);
                productGrid.innerHTML = '';
                if (querySnapshot.empty) {
                    productGrid.innerHTML = '<p class="col-span-full text-center text-gray-500">No products match your criteria.</p>';
                } else {
                    querySnapshot.forEach((doc) => productGrid.appendChild(createProductCardElement(doc.id, doc.data())));
                }
            }
        }
        updateFilterUIs();
    }
    
    function generateStars(rating = 0) {
        let starsHTML = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                starsHTML += starFilledIcon;
            } else {
                starsHTML += starEmptyIcon;
            }
        }
        return starsHTML;
    }

    function createProductCardElement(productId, product) {
        const cardWrapper = document.createElement('div');
        const isWishlisted = wishlistedProductIds.has(productId);
        const displayImage = product.imageUrl || 'https://placehold.co/400x500/f0f0f0/666?text=No+Image';

        const rating = product.rating || (Math.random() * 2 + 3).toFixed(1);
        const reviewCount = product.reviewCount || Math.floor(Math.random() * 50) + 1;
        const oldPrice = product.oldPrice || product.price * 1.25;

        cardWrapper.innerHTML = `
            <div class="group relative overflow-hidden rounded-lg bg-white border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                <a href="product-detail.html?id=${productId}">
                    <img src="${displayImage}" alt="${product.name}" class="w-full h-auto aspect-[3/4] object-cover object-center group-hover:scale-105 transition-transform duration-300">
                </a>
                <button class="wishlist-btn absolute top-2 right-2 p-2 rounded-full bg-white/80 backdrop-blur-sm text-gray-700 hover:text-red-500 transition-colors" data-product-id="${productId}">
                    ${isWishlisted ? heartIconFilled : heartIconEmpty}
                </button>
            </div>
            <div class="mt-3 px-1">
                 <a href="product-detail.html?id=${productId}" class="text-sm text-blue-700 hover:text-blue-900 transition-colors">${product.name}</a>
                 <div class="flex items-center mt-1">
                      ${generateStars(rating)}
                      <span class="text-xs text-gray-500 ml-2">(${reviewCount})</span>
                 </div>
                 <div class="mt-2 flex items-center gap-2">
                      <p class="text-md font-bold text-gray-900">Rs. ${product.price.toLocaleString()}</p>
                      <p class="text-sm text-gray-500 line-through">Rs. ${oldPrice.toLocaleString()}</p>
                 </div>
            </div>`;
        return cardWrapper;
    }

    function updateAllWishlistIcons() {
        document.querySelectorAll('.wishlist-btn').forEach(btn => {
            const productId = btn.dataset.productId;
            const isWishlisted = wishlistedProductIds.has(productId);
            btn.innerHTML = isWishlisted ? heartIconFilled : heartIconEmpty;
        });
    }

    async function toggleWishlistItem(productId) {
        const user = auth.currentUser;
        if (!user) { authModal.classList.remove('hidden'); return; }
        const wishlistRef = doc(db, 'wishlists', user.uid, 'items', productId);
        try {
            if (wishlistedProductIds.has(productId)) {
                await deleteDoc(wishlistRef);
            } else {
                const productRef = doc(db, 'products', productId);
                const productSnap = await getDoc(productRef);
                if (productSnap.exists()) {
                    await setDoc(wishlistRef, { ...productSnap.data(), addedAt: new Date() });
                }
            }
        } catch (error) { console.error("Error updating wishlist:", error); }
    }

    onAuthStateChanged(auth, user => {
        if (user) {
            listenToUserData(user.uid);
            userText.textContent = "My Account";
        } else {
            if (wishlistListener) wishlistListener();
            if (cartListener) cartListener();
            wishlistedProductIds.clear();
            updateAllWishlistIcons();
            document.getElementById('cart-count').classList.add('hidden');
            userText.textContent = "Log in / Register";
        }
    });

    function listenToUserData(userId) {
        const wishlistRef = collection(db, 'wishlists', userId, 'items');
        wishlistListener = onSnapshot(wishlistRef, snapshot => {
            wishlistedProductIds = new Set(snapshot.docs.map(doc => doc.id));
            updateAllWishlistIcons();
        });
        const cartRef = collection(db, 'carts', userId, 'items');
        cartListener = onSnapshot(cartRef, snapshot => {
            const count = snapshot.size;
            const cartCountEl = document.getElementById('cart-count');
            cartCountEl.textContent = count;
            cartCountEl.classList.toggle('hidden', count === 0);
        });
    }

    function setupAuthModal() {
        const loginTab = authModal.querySelector('#login-tab');
        const signupTab = authModal.querySelector('#signup-tab');
        const loginForm = authModal.querySelector('#login-form');
        const signupForm = authModal.querySelector('#signup-form');
        const googleBtn = authModal.querySelector('#google-signin-btn');
        const authError = authModal.querySelector('#auth-error');
        const userEmailDisplay = userInfoModal.querySelector('#user-email-display');
        const logoutButton = userInfoModal.querySelector('#logout-button');
        const closeUserModal = userInfoModal.querySelector('#close-user-modal');

        userButton.addEventListener('click', () => {
            if (auth.currentUser) {
                userEmailDisplay.textContent = auth.currentUser.email;
                userInfoModal.classList.remove('hidden');
            } else {
                authModal.classList.remove('hidden');
            }
        });
        authModal.addEventListener('click', e => { if (e.target === authModal) authModal.classList.add('hidden'); });
        userInfoModal.addEventListener('click', e => { if (e.target === userInfoModal) userInfoModal.classList.add('hidden'); });
        closeUserModal.addEventListener('click', () => userInfoModal.classList.add('hidden'));

        loginTab.addEventListener('click', () => {
            loginTab.classList.replace('bg-white', 'bg-gray-100');
            signupTab.classList.replace('bg-gray-100', 'bg-white');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        });
        signupTab.addEventListener('click', () => {
            signupTab.classList.replace('bg-white', 'bg-gray-100');
            loginTab.classList.replace('bg-gray-100', 'bg-white');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });

        loginForm.addEventListener('submit', async e => {
            e.preventDefault(); authError.textContent = '';
            try {
                await signInWithEmailAndPassword(auth, loginForm['login-email'].value, loginForm['login-password'].value);
                authModal.classList.add('hidden');
            } catch (error) { authError.textContent = error.message; }
        });
        signupForm.addEventListener('submit', async e => {
            e.preventDefault(); authError.textContent = '';
            try {
                await createUserWithEmailAndPassword(auth, signupForm['signup-email'].value, signupForm['signup-password'].value);
                authModal.classList.add('hidden');
            } catch (error) { authError.textContent = error.message; }
        });
        googleBtn.addEventListener('click', async () => {
            authError.textContent = '';
            try {
                await signInWithPopup(auth, new GoogleAuthProvider());
                authModal.classList.add('hidden');
            } catch (error) { authError.textContent = error.message; }
        });
        logoutButton.addEventListener('click', async () => {
            await signOut(auth);
            userInfoModal.classList.add('hidden');
        });
    }

    function setupStickyScroll() {
        if (isMobileView()) return; 

        const productContainer = document.querySelector('#product-grid-container');
        const mainContent = document.querySelector('main');

        if (!productContainer || !mainContent) return;

        const observer = new IntersectionObserver(
            ([entry]) => {
                if (entry.isIntersecting) {
                    document.body.classList.remove('no-scroll');
                } else if (entry.boundingClientRect.top < 0) {
                    document.body.classList.add('no-scroll');
                }
            },
            { threshold: [0] }
        );

        observer.observe(productContainer);

        mainContent.addEventListener('scroll', () => {
            const isAtTop = mainContent.scrollTop === 0;
            const isAtBottom = mainContent.scrollHeight - mainContent.scrollTop <= mainContent.clientHeight + 1;

            if (document.body.classList.contains('no-scroll')) {
                if (isAtTop || isAtBottom) {
                    document.body.classList.remove('no-scroll');
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', async () => {
        setupAuthModal();
        await populateFilterOptions();
        
        if(!isMobileView()) {
            setupStickyScroll();
        }
        
        loadProducts();
        setupHeroSlider();
        setupCategoryAutoSlide();
        
        const searchHandler = (e) => {
            e.preventDefault();
            const input = e.target.querySelector('input');
            const searchTerm = input.value.trim();
            if (searchTerm) {
                alert(`You searched for: ${searchTerm}`);
            }
        };

        document.getElementById('desktop-search-form').addEventListener('submit', searchHandler);
        document.getElementById('mobile-search-form').addEventListener('submit', searchHandler);

        ['desktop', 'mobile'].forEach(view => {
            const panel = document.getElementById(`${view}-filter-panel`);
            if (!panel) return;
            panel.querySelector(`#${view}-apply-filters-btn`)?.addEventListener('click', applyFilters);
            panel.querySelector(`#${view}-clear-filters-btn`)?.addEventListener('click', clearFilters);
        });

        closeFilterBtn.addEventListener('click', () => toggleMobileFilterSidebar(false));
        mobileFilterSidebar.addEventListener('click', (e) => { if (e.target === mobileFilterSidebar) toggleMobileFilterSidebar(false); });
        mainContentArea.addEventListener('click', e => {
            const wishlistBtn = e.target.closest('.wishlist-btn');
            if (wishlistBtn) toggleWishlistItem(wishlistBtn.dataset.productId);
        });
    });
</script>
</body>
</html>